
## MD

The MD rules use input files (or input file templates) that
are located in `libs/md_parameters`. Consult these files for 
details about the parameters that are used in the MD simulations.
However, every simulation that was run as part of the workflow has its own copy
of these files in the `workflow/data` directory, 
with all parameters that were used in that particular simulation.

### Topology generation
For details of the topology creation, see above. 
MD input files are generated by the following rule:
* `md_build_leap`: generates a leap file to be run by `md_make_topology`
* `md_make_topology`: generates the topology files for the MD simulation

### Energy minimization and equilibration
Then, the following rules are run to energy minimise and equilibrate the system:
* `md_em_1`: energy minimisation 1
* `md_em_2`: energy minimisation 2
* `md_em_3`: energy minimisation 3
* `md_eq_1`: equilibration 1
* `md_eq_2`: equilibration 2
* `md_em_eq_analysis`: analysis of the energy minimisation and equilibration steps

`md_em_eq_analysis` uses the following rules to extract quantities of interest:
* `md_readEpot` : extracts the potential energy from the MD.out file
* `md_readT` : extracts the temperature from the MD.out file
* `md_readrho` : extracts the density from the MD.out file
* `md_readPress` : extracts the pressure from the MD.out file

### cMD
The following rules are for cMD production simulations:
* `md_cMD_make_param`: generates the input file for the cMD production simulation
* `md_cMD_prod`: runs the cMD production simulation
* `md_cMD_analysis`: analyses the cMD production simulation

### aMD
The following rules are for aMD simulations:
* `md_aMD_cMD`: runs a 10 ns cMD equilibration step
* `md_aMD_cMD_readE`: reads the energy from the cMD equilibration step
* `md_aMD_make_param`: generates the input file for the aMD simulation, based on
the cMD equilibration step
* `md_aMD_prod`: runs the aMD production simulation
* `md_aMD_pre_ana`: extracts boosting parameters for reweighting
* `md_aMD_analysis`: analyses the aMD production simulation

### GaMD
The following rules are for GaMD simulations:
* `md_GaMD_make_param`: generates the input file for the GaMD simulation
* `md_GaMD_full`: runs the GaMD equilibration & production simulation
* `md_gaMD_pre_ana`: extracts boosting parameters for reweighting
* `md_GaMD_analysis`: analyses the GaMD production simulation

### Comparison of different MD methods
The followin rules are for comparing different MD simulations of the same 
compound to each other:
* `md_comp_analysis`: Compare simulations of different methods, but the same 
compound.

Different MD runs of the same compound can be compared by specifying 3 unique
hashes of the MD runs in the `snakemake-config` file. The hashes for any 
parameters that were input in the `samples.tsv` file are stored in the 
`samples_old.tsv` file.


An overview of the entire workflow and rules is shown in the following figure:
![Detailed overview of the rules that make up the computational workflows ](reports/dags/dag_full.pdf "Rules that make up the computational workflows")
